<html>
<head>
<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
<meta name="viewport" content="user-scalable=no, width=device-width"  />
<meta name="apple-mobile-web-app-capable" content="yes" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>  
<!--
    Include the maps javascript with sensor=true because this code is using a
    sensor (a GPS locator) to determine the user's location.
    See: http://code.google.com/apis/maps/documentation/javascript/basics.html#SpecifyingSensor
    -->
    <script type="text/javascript"
        src="http://maps.googleapis.com/maps/api/js?sensor=true"></script>
  <title>vitrum/node_123 @ GitHub</title>

  <style type="text/css">
    body {
      margin-top: 1.0em;
      background-color: #222;
      font-family: Helvetica, Arial, FreeSans, san-serif;
      color: #ffffff;
      width:100%;
      min-width:320px; max-width:480px;
      font-size:12px;
    }
  
    .btn { 
      float:left;
      background:-webkit-gradient(linear,left top,left bottom,from(#959595),to(#efefef));
      background:-moz-linear-gradient(center bottom,#959595,#efefef);
      border-radius: 10px 10px 10px 10px;
      line-height: 15px;
      height: 40px;
      margin: 4px 0 0 4px;
      padding: 6px;
      text-align: center;
      width: 90%;
    }
    .btn_red {
      background:-webkit-gradient(linear,left top,left bottom,from(#ff9595),to(#ffefef));
      background:-moz-linear-gradient(center bottom,#ff9595,#ffefef);
    }
    .btn_small {
      width:100px;
    }
    .log {
      width:90%;
      height:200px;
      overflow: auto;
      font-size:10px;
    }
    .baidumap {
      width:90%;
      height:300px;
    }
    .title {
      float:left;
      clear:both;
    }
  </style>
</head>

<body>
  <div id="info" class="log"></div>
  <div class="menu">
    <button id="btnClen" class="btn btn_red btn_small" >Clearn</button>
    <button id="btnSave" class="btn btn_small" >Save</button>
    <button id="btnLoad" class="btn btn_small" >Load</button>
    <button id="btnInit" class="btn" >Find my location</button>
  
  </div> 
  <!--
  <input value='GPS->baidu' type='button' onclick='alert("GPS->baidu");BMap.Convertor.translate(new BMap.Point(116.397428,39.90923),0,translateOptions);' />
  -->
  <h3 class="title">Baidu Map</h3>
  <p class="title">百度 gps:<span id='baiduXY'> </span></p>
  <div id="container" class="baidumap"></div>
  <h3 class="title">GOOGLE Map</h3>
  <div id="map_canvas"></div>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.2&services=true"></script>

<script>
  /*geolocation  */
  var touchTime = 1 ;
  var geolocationJson = '';
  var bm = new BMap.Map("container");

  		translateOptions = function (point){
			bm.clearOverlays();
			var marker = new BMap.Marker(point);
			bm.addOverlay(marker);
			bm.setCenter(point);
			document.getElementById("baiduXY").innerHTML = point.lng + "," + point.lat;
		}
  
        jQuery(window).ready(function(){  
            jQuery("#btnInit").click(initiate_geolocation); 
            
            jQuery("#btnClen").click(clearn_log); 
            
            jQuery("#btnSave").click(save_log); 
            
            jQuery("#btnLoad").click(load_log); 
            

             
        });  
  
        function initiate_geolocation() {  
            navigator.geolocation.getCurrentPosition(handle_geolocation_query,errorCallback);  
        }  
        
        function errorCallback(error) {
          // Update a div element with error.message.
          var text = "touchTime:" + touchTime + "<br/>error.message: "  + error.message + "<br/>" ;;
          jQuery("#info").prepend(text); 
          
        }
        
        function handle_geolocation_query(position){  
             var text =  "touchTime:" + touchTime + "<br/>Latitude: "  + position.coords.latitude  + "<br/>" +  
               "Longitude: " + position.coords.longitude + "<br/>" +  
               "Accuracy: "  + position.coords.accuracy  + "m<br/>" +  
               "Time: " + new Date(position.timestamp)+ "<br/><br/>" ;  
            jQuery("#info").prepend(text); 
            touchTime = touchTime + 1 ;

			/*google map image*/
            var image_url = "http://maps.google.com/maps/api/staticmap?sensor=false&center=" + position.coords.latitude + "," +  
                    position.coords.longitude + "&zoom=17&size=320x200&markers=color:blue|label:S|" +  
                    position.coords.latitude + ',' + position.coords.longitude;  
  
            jQuery("#map").remove();  
            jQuery(document.body).append(  
              jQuery(document.createElement("img")).attr("src", image_url).attr('id','map')  
            );  
            

			/* baidu map */
            /*
			var map = new BMap.Map("container");
            var point = new BMap.Point(position.coords.longitude, position.coords.latitude);
            map.addControl(new BMap.NavigationControl())
            map.centerAndZoom(point,17);
			*/
			//BMap.Convertor.translate(new BMap.Point(116.397428,39.90923),0,translateOptions);

			
			var point = new BMap.Point(position.coords.longitude, position.coords.latitude);


			bm.centerAndZoom(point, 19);
			bm.addControl(new BMap.NavigationControl());
			
			BMap.Convertor.translate(new BMap.Point(position.coords.longitude,position.coords.latitude),0,translateOptions);


             
        }  



        function clearn_log() {  
            var text = "";
            jQuery("#info").html(text);
            touchTime = 1 ;
            
        }  
        function save_log() {  
            var text = "";
            geolocationJson = jQuery("#info").html();
            jQuery("#info").html(text);
            
        }  
        function load_log() {  
            var text = "";
            jQuery("#info").html(text);
            jQuery("#info").html(geolocationJson);
            
        }  
 

    


</script>
<script type="text/javascript">
      var map;

      function initialize() {
        var myOptions = {
          zoom: 17,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map(document.getElementById('map_canvas'),
            myOptions);

        // Try HTML5 geolocation
        if(navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = new google.maps.LatLng(position.coords.latitude,
                                             position.coords.longitude);

            var infowindow = new google.maps.InfoWindow({
              map: map,
              position: pos,
              content: 'Location found using HTML5.'
            });

            map.setCenter(pos);
          }, function() {
            handleNoGeolocation(true);
          });
        } else {
          // Browser doesn't support Geolocation
          handleNoGeolocation(false);
        }
      }

      function handleNoGeolocation(errorFlag) {
        if (errorFlag) {
          var content = 'Error: The Geolocation service failed.';
        } else {
          var content = 'Error: Your browser doesn\'t support geolocation.';
        }

        var options = {
          map: map,
          position: new google.maps.LatLng(60, 105),
          content: content
        };

        var infowindow = new google.maps.InfoWindow(options);
        map.setCenter(options.position);
      }

      google.maps.event.addDomListener(window, 'load', initialize);
      
      /*百度 马屁*/
      (function(){        //闭包
function load_script(xyUrl, callback){
    var head = document.getElementsByTagName('head')[0];
    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.src = xyUrl;
    //借鉴了jQuery的script跨域方法
    script.onload = script.onreadystatechange = function(){
        if((!this.readyState || this.readyState === "loaded" || this.readyState === "complete")){
            callback && callback();
            // Handle memory leak in IE
            script.onload = script.onreadystatechange = null;
            if ( head && script.parentNode ) {
                head.removeChild( script );
            }
        }
    };
    // Use insertBefore instead of appendChild  to circumvent an IE6 bug.
    head.insertBefore( script, head.firstChild );
}
function translate(point,type,callback){
    var callbackName = 'cbk_' + Math.round(Math.random() * 10000);    //随机函数名
    var xyUrl = "http://api.map.baidu.com/ag/coord/convert?from="+ type + "&to=4&x=" + point.lng + "&y=" + point.lat + "&callback=BMap.Convertor." + callbackName;
    //动态创建script标签
    load_script(xyUrl);
    BMap.Convertor[callbackName] = function(xyResult){
        delete BMap.Convertor[callbackName];    //调用完需要删除改函数
        var point = new BMap.Point(xyResult.x, xyResult.y);
        callback && callback(point);
    }
}

window.BMap = window.BMap || {};
BMap.Convertor = {};
BMap.Convertor.translate = translate;
})();
      
      
      
    </script>
</body>
</html>








